<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<!--<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />-->
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" href="css/cropper.min.css">
		<link rel="stylesheet" href="css/ImgCropping.css">
		<link rel="stylesheet" href="css/cropper.min.css">
		<link rel="stylesheet" href="css/ImgCropping.css">
		<title></title>
		<script src="js/jquery.min.js"></script>
		<script src="js/distpicker.data.js"></script>
		<script src="js/distpicker.js"></script>
		<script src="js/config.js"></script>
		<script src="js/public.js"></script>
		<script src="js/cropper.min.js"></script>

	</head>

	<body>
		<!--上传插件-->
		<!--图片裁剪框 start-->
		<div style="display: none" class="tailoring-container">
			<div class="black-cloth" onClick="closeTailor(this)"></div>
			<div class="tailoring-content">
				<div class="tailoring-content-one">
					<label title="上传图片" for="chooseImg" class="l-btn choose-btn">
                    <input type="file" accept="image/jpg,image/jpeg,image/png" name="file" id="chooseImg" class="hidden" onChange="selectImg(this)">
                    选择图片
                </label>
					<div class="close-tailoring" onclick="closeTailor(this)">×</div>
				</div>
				<div class="tailoring-content-two">
					<div class="tailoring-box-parcel">
						<img id="tailoringImg">
					</div>
					<div class="preview-box-parcel">
						<p>图片预览：</p>
						<div class="square previewImg"></div>
						<div class="circular previewImg"></div>
					</div>
				</div>
				<div class="tailoring-content-three">
					<button class="l-btn cropper-reset-btn">复位</button>
					<button class="l-btn cropper-rotate-btn">旋转</button>
					<button class="l-btn cropper-scaleX-btn">换向</button>
					<button class="l-btn sureCut" id="sureCut">确定</button>
				</div>
			</div>
		</div>

		<div class="main">
			<script src="js/header.js"></script>

			<div class="container">
				<div class="Bread">
					<a href="index.html">首页</a>
					<a href="UserCenter-mine.html">个人中心</a>
					<a href="">个人信息</a>
				</div>
				<div class="usercenter">
					<div class="usercenter-left">
						<ul>
							<li class="title">个人中心</li>
							<li>
								<a href="UserCenter-mine.html">我的个人中心</a>
							</li>
							<li class="active">
								<a href="UserCenter-info-default.html">个人信息</a>
							</li>
							<li>
								<a href="UserCenter-TransferAccounts.html">转账</a>
							</li>
						</ul>
						<ul>
							<li class="title">订单中心</li>
							<li>
								<a href="UserCenter-orders.html">我的订单</a>
							</li>
							<li>
								<a href="UserCenter-Return.html">退货</a>
							</li>
						</ul>
					</div>
					<div class="usercenter-right">
						<div class="ctn">
							<h1>个人中心</h1>
							<div class="mbx">
								<a href="UserCenter-info-default.html" class="active">基本信息</a>
								<a href="UserCenter-info.html">账号信息</a>
							</div>
							<div class="searchbox ">
								<form id="form1">
									<div class="headbox">
										<div class="head">
											<img src="img/face2.png" id="uesrhead" />
										</div>
										<div class="h-r">
											<div class="uphead" style="position: relative;" id="replaceImg">
												<!--<input type="file" id="headPortraitUpdata" style="position: absolute; opacity: 0;"></input>-->
												上传店招
											</div>
											<p>仅支持JPG、PNG、JPEG、BMP格式，文件小于4M</p>

										</div>

									</div>
									<ul>
										<li>
											<div class="lable">
												<span>姓名：</span>
											</div>
											<input name="realName" id="realName" class="biginput biginput" placeholder="请填写真实姓名" />
										</li>
										<li>
											<div class="lable">
												<span>身份证号：</span>
											</div>
											<input name="idCardNo" id="idCardNo" class="biginput biginput" placeholder="请填写真实的身份证号码" />

										</li>
										<li>
											<div class="lable">
												<span>性别：</span>
											</div>
											<input type="radio" name="sex" checked="checked" value="1" /><span>男</span>
											<input type="radio" name="sex" value="-1" /><span>女</span>

										</li>
										<li>
											<div class="lable">
												<span>生日：</span>
											</div>
											<input class="biginput biginput" type="date" value="2019-05-03 00:00:00" id="birthday" name="birthday" />

										</li>
										<li id="distpicker2">
											<div class="lable">
												<span>地址：</span>
											</div>
											<select name="province" id="province">
												<option>请选择 省份 </option>
											</select>
											<select name="city" id="city">
												<option>请选择 市 </option>
											</select>
											<select name="country" id="country">
												<option>请选择 区( 县 ) </option>
											</select>

										</li>
										<li>
											<div class="lable">
												<span>&nbsp;</span>
											</div>
											<input id="addressDetails" name="addressDetails" class="biginput biginput" placeholder="详细街道、楼牌号等" />

										</li>
										<li>
											<div class="lable">
												<span>&nbsp;</span>
											</div>
											<input name="token" value="" id="token" style="display: none;" />
											<input name="headPortrait" id="headPortrait" value="" style="display: none;" />
											<a href="javascript:void(0)" class="btn" id="updata">确认</a>
										</li>
									</ul>

									<div class="clearfix"></div>
								</form>
							</div>
						</div>

					</div>
				</div>

				<!--<div class="clearfix"></div>-->
			</div>
			<div class="clearfix"></div>
			<div class="footer">
				<div class="container">
					<ul>
						<li><span>如意洲官网</span></li>
						<li><span>7天无理由退货</span></li>
						<li><span>15天免费换货</span></li>
						<li><span>购物享更多优惠</span></li>
						<li><span>全国服务店网点</span></li>
					</ul>
					<p class="copyright">如意洲商城©2019 承德市如意洲商贸有限公司版权所有 京ICP备08010318号 京公网安备11000002000088号</p>
				</div>
			</div>
		</div>
		<script>
			(function($) {
				$.fn.serializeJSON = function() {
					var obj = {};
					var count = 0;
					$.each(this.serializeArray(), function(i, o) {
						var n = o.name,
							v = o.value;
						count++;
						obj[n] = obj[n] === undefined ? v :
							$.isArray(obj[n]) ? obj[n].concat(v) : [obj[n], v];
					});
					//obj.nameCounts = count + "";//表单name个数
					return JSON.stringify(obj);
				};
				//资源编辑页管理对象

				var imgPath;//保存头像path

				var FormObj = {
					Init: function() {
						publc_Obj.islogin();
						publc_Obj.AddEvent();
						this.AddEvent();
						this.getuserinfo();
					},
					getuserinfo: function() {
						//用户信息
						if(localStorage.getItem("token")) {
							$.ajax({
								type: "post",
								url: Work_Config.InterfaceDomain + "/user/getShopMemberInfo",
								async: true,
								data: {
									token: localStorage.getItem("token")
								},
								success: function(data) {
									imgPath = data.data.headPortrait;
									if(data.code == 0) {
										if(data.data.headPortrait) {
										$("#uesrhead").attr("src", data.data.headPortrait)
										}
										$("#addressDetails").val(data.data.address);
										if(data.data.birthday) {
											$("#birthday").val(data.data.birthday.substring(0,10));
										}

										$("#province").val(data.data.province);
										$("#province").change()
										$("#city").val(data.data.city);
										$("#city").change()
										$("#country").val(data.data.country);
										$("#idCardNo").val(data.data.idCardNo);
										$("#realName").val(data.data.realName);
										$("input[name='sex'][value=" + data.data.sex + "]").attr("checked", true);
									}

								},
								error: function() {

								}
							});

						}

					},
					AddEvent: function() {
						$("#updata").click(function() {
							$("#token").val(localStorage.getItem("token"))
							var serStr = JSON.parse($('#form1').serializeJSON())
							if(serStr.headPortrait == ''){
								serStr.headPortrait = imgPath;
							}
                            if (!serStr.birthday) {
                                publc_Obj.message("生日不能为空");
                                return;
                            }
							$.ajax({
								type: "post",
								url: Work_Config.InterfaceDomain + "/user/updateUserInfo",
								async: true,
								data: serStr,
								success: function(data) {
									if(data.code == 0) {

									}
									if(data.code == 100) {
										//										window.location.href = "login.html"
									}
									publc_Obj.message(data.message)

								},
								error: function() {}

							})
						})
					}

				};
				//初始化
				FormObj.Init();
			}(jQuery));

			$("#distpicker2").distpicker({
				province: "---- 所在省 ----",
				city: "---- 所在市 ----",
				district: "---- 所在区 ----"
			});

			//上传插件
			//弹出框水平垂直居中
			(window.onresize = function() {
				var win_height = $(window).height();
				var win_width = $(window).width();
				if(win_width <= 768) {
					$(".tailoring-content").css({
						"top": (win_height - $(".tailoring-content").outerHeight()) / 2,
						"left": 0
					});
				} else {
					$(".tailoring-content").css({
						"top": (win_height - $(".tailoring-content").outerHeight()) / 2,
						"left": (win_width - $(".tailoring-content").outerWidth()) / 2
					});
				}
			})();

			//弹出图片裁剪框
			$("#replaceImg").on("click", function() {
				$(".tailoring-container").toggle();
			});
			//图像上传
			function selectImg(file) {
				if(!file.files || !file.files[0]) {
					return;
				}
				var reader = new FileReader();
				reader.onload = function(evt) {
					var replaceSrc = evt.target.result;
					//更换cropper的图片
					$('#tailoringImg').cropper('replace', replaceSrc, false); //默认false，适应高度，不失真
				}
				reader.readAsDataURL(file.files[0]);
			}
			//cropper图片裁剪
			$('#tailoringImg').cropper({
				aspectRatio: 1 / 1, //默认比例
				preview: '.previewImg', //预览视图
				guides: false, //裁剪框的虚线(九宫格)
				autoCropArea: 0.5, //0-1之间的数值，定义自动剪裁区域的大小，默认0.8
				movable: false, //是否允许移动图片
				dragCrop: true, //是否允许移除当前的剪裁框，并通过拖动来新建一个剪裁框区域
				movable: true, //是否允许移动剪裁框
				resizable: true, //是否允许改变裁剪框的大小
				zoomable: false, //是否允许缩放图片大小
				mouseWheelZoom: false, //是否允许通过鼠标滚轮来缩放图片
				touchDragZoom: true, //是否允许通过触摸移动来缩放图片
				rotatable: true, //是否允许旋转图片
				crop: function(e) {
					// 输出结果数据裁剪图像。
				}
			});
			//旋转
			$(".cropper-rotate-btn").on("click", function() {
				$('#tailoringImg').cropper("rotate", 45);
			});
			//复位
			$(".cropper-reset-btn").on("click", function() {
				$('#tailoringImg').cropper("reset");
			});
			//换向
			var flagX = true;
			$(".cropper-scaleX-btn").on("click", function() {
				if(flagX) {
					$('#tailoringImg').cropper("scaleX", -1);
					flagX = false;
				} else {
					$('#tailoringImg').cropper("scaleX", 1);
					flagX = true;
				}
				flagX != flagX;
			});

			//裁剪后的处理
			$("#sureCut").on("click", function() {
				if($("#tailoringImg").attr("src") == null) {
					return false;
				} else {
					var cas = $('#tailoringImg').cropper('getCroppedCanvas'); //获取被裁剪后的canvas
					var base64url = cas.toDataURL("image/jpeg", 0.5); //转换为base64地址形式
					$("#uesrhead").prop("src", base64url); //显示为图片的形式
					$.ajax({
						type: "post",
						url: Work_Config.uploadpic + "/uploadBase64",
						async: true,
						data: {
							base64Data:base64url
						},
						success: function(data) {
							imgPath = data.data.imgPathSmall;
							if(data.code == 0) {
                              $("#headPortrait").val(data.data.imgPathSmall)
							}
							if(data.code == 100) {
								//										window.location.href = "login.html"
							}
							publc_Obj.message(data.message)

						},
						error: function() {}

					})
					//关闭裁剪框
					closeTailor();
				}
			});
			//关闭裁剪框
			function closeTailor() {
				$(".tailoring-container").toggle();
			}
		</script>
	</body>

</html>